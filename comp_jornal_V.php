<html><head>  <title>Журнал выдачи"</title>    <script src="../js/jquery.js"></script>	<script src="../js/bootstrap.js"></script>	<link rel="stylesheet" type="text/css" href="../css/bootstrap.css"></head><body  bgcolor=""><form>     <h3 align="center">Журнал выдачи вычислительной техники ПАО "КЭТЗ"</h3>      <?php	 //если пришли даты начала и конца			if(isset($_REQUEST['dateStart']))				$a=$_GET['dateStart'];			else 			{	$a=new DateTime(date("Y-m-d"));				$a->modify("-".date('N')." month");				$a=$a->format("Y-m-d");			}			if(isset($_REQUEST['dateFinish']))				$b=$_GET['dateFinish'];			else		    {				$c=new DateTime(date("Y-m-d"));				$c->modify("-".date('N')." month");				$c=$c->format("Y-m-d");				$b=date("Y-m-d");			}			     ?><form>    Дата выдачи:   <table  border="0">        <TR>		             <TD align="center">              С <input type='date' id='dateStart' name='dateStart' value="<?php echo $a;?>">             </TD>            <TD align="center">              По <input type='date' id='dateFinish' name='dateFinish' value="<?php echo $b;?>">             </TD>			<TD>			<?php			    //Выбор из оборудования, принтеры, сканеры и др. объединены в пункт 'офисная техника' и заполнение селекта			    $sql_s01 = "SELECT id_type, name_type, delete_type FROM comp_type where id_type not in (8, 9, 10, 11, 12, 13, 14, 15) union all Select -2, 'Офисная техника', 0"; 				$result01 = mysql_query($sql_s01, $db);				if (mysql_num_rows($result01)!="")				    if (isset($_REQUEST['name_type']))					{					   if ($_REQUEST['name_type'] == '0')					      $selectet_type = -1;					   else 					      $selectet_type = $_REQUEST['name_type'];				    }					else 					$selectet_type = -1;				{				    echo '<select name = "name_type" id = "name_type">';					echo '<option value = "0">Оборудование</option>';				}				for ($i = 0; $i < mysql_num_rows($result01); $i++)				    {					  $res01 = mysql_fetch_array($result01);					  echo '<option value = "'.$res01['name_type'].'"';					  if($res01['name_type'] == $selectet_type) echo " selected=selected"; 					  echo '>'.$res01['name_type'].'</option>';					}				echo '</select>';			?>			</TD>			<TD>			<?php			    // заполнение селекта всеми возможными статусами 			    $sql_s02 = "Select * from comp_status where delete_status = 0 order by id_status";				$result02 = mysql_query($sql_s02, $db);				if (mysql_num_rows($result02)!="")				    if (isset($_REQUEST['name_status']))					{					   if ($_REQUEST['name_status'] == '0')					      $selectet_status = -1;					   else 					      $selectet_status = $_REQUEST['name_status'];				    }					else 					$selectet_status = -1;												    echo '<select name = "name_status" id = "name_status">';					echo '<option value = "0">Статус</option>';					echo '<option value = "в ремонте"';					if ("в ремонте" == $selectet_status) echo " selected=selected"; 					echo '>в ремонте</option>';								for ($i = 0; $i < mysql_num_rows($result02); $i++)				    {					  $res02 = mysql_fetch_array($result02);					  echo '<option value = "'.$res02['name_status'].'"';					  if($res02['name_status'] == $selectet_status) echo " selected=selected"; 					  echo '>'.$res02['name_status'].'</option>';					}				echo '</select>';			?>			</TD>            <TD> 			<?php				// заполнение селекта отделами			    $sql_ss = "SELECT * FROM koef.otdel order by Number_otd";				$result = mysql_query($sql_ss);				if(mysql_num_rows($result)!="")				{						 if(isset($_REQUEST['otd']))						 {							if($_REQUEST['otd'] > 0)							{								$selectet_otd = $_REQUEST['otd'];							}							else							{								$selectet_otd = -1;							}						 }						 else						 {							$selectet_otd = -1;						 }												echo '<select name="otd" id="otd"> ';					echo '<option value="0">Выберите отдел</option>';								for($i = 0; $i < mysql_num_rows($result); $i++)						{							$res = mysql_fetch_array($result);							echo '<option value="'.$res['id_otd'].'"';							if($res['id_otd'] == $selectet_otd) echo " selected=selected";  							echo '>'.$res['Number_otd'].' '.$res['Name_otd'].'</option>';						}				echo '</select>';				echo '</TD>';				echo '<TD>';				}                if(isset($_GET['otd']))				{					if(isset($_REQUEST['work']))						 {							if($_REQUEST['work'] > 0)							{								$selectet_work = $_REQUEST['work'];							}							else							{								$selectet_work = 0;							}						 }						 else						 {							$selectet_work = -1;						 }								  {				  //выбор сотрудников					$res_sot = mysql_query("SELECT Id_sot, Fam, LEFT(Imya,1) AS Imya, LEFT(Otch,1) AS Otch FROM sotrydniki WHERE (Otdel_id = ".$_GET['otd'].")  ORDER BY Fam");					echo '<select name="work" id="work" onchange="onMyChange()"> ';						echo '<option value="0">Выберите сотрудников </option>';;						for($i = 0; $i < mysql_num_rows($res_sot); $i++)						{							$res = mysql_fetch_array($res_sot);							echo '<option value="'.$res['Id_sot'].'"';							if($res['Id_sot'] == $selectet_work) echo " selected=selected";  							echo '>'.$res['Fam'].' '.$res['Imya'].'.'.$res['Otch'].'.</option>';						}						echo '</select>';					}				}				else echo 						"<select>					<option value='0'>Выберите сотрудника</option>				</select>				";				echo '</TD>';                ?>				            </TD>			        </TR>    </table>	<center> <input type="submit" name="go_sel" value="Просмотреть" /> </br> </br></FORM>   <?php//формирование  запроса в зависимости от выбранных опций поискаif ((isset($_GET['dateStart'])) AND (isset($_GET['dateFinish']))) {$queryTerms = 'Where (1 = 1)';    if ((isset($_GET['name_type'])) AND ($_GET['name_type']!='0') AND ($_GET['name_type']!='Офисная техника'))  //  выбор типа оборудования    {     $queryTerms .=' And (name_type = "'.$_GET['name_type'].'") ';     }    elseif ((isset($_GET['name_type'])) AND ($_GET['name_type']=='Офисная техника'))  // если выбрали оборудование из группы офисной техники	{	 $queryTerms .=' And (id_type in (8, 9, 10, 11, 12, 13, 14, 15)) ' ;	}    elseif ((isset($_GET['name_type'])) AND ($_GET['name_type']=='0')) // 0 значит что выбрали все оборудование    {     $queryTerms .='';     }		if ((isset($_GET['name_status'])) AND ($_GET['name_status']!='0'))        {          $queryTerms .= ' And (name_status = "'.$_GET['name_status'].'") ';	    }        elseif ((isset($_GET['name_status'])) AND ($_GET['name_status']=='0'))        {         $queryTerms .='';         } 				if ((isset($_GET['otd'])) AND ($_GET['otd']!='0'))                {                   $queryTerms .= ' And (id_otd = "'.$_GET['otd'].'") ';	            }                elseif ((isset($_GET['otd'])) AND ($_GET['otd']=='0'))                {                 $queryTerms .='';                 }				  if ((isset($_GET['work'])) AND ($_GET['work']!='0'))                  {                     $queryTerms .= ' And (id_sot = "'.$_GET['work'].'") ';	              }                  elseif ((isset($_GET['work'])) AND ($_GET['work']=='0'))                  {                   $queryTerms .='';                   }}Else $queryTerms = 'Where (1=1)';$SQLBig = 'Select * from                           (                            SELECT *                            FROM comp_type, comp_producer, comp_model, comp_element, comp_one, comp_journal_give, comp_status						    WHERE (vid_type=id_type)						      AND (vid_producer=id_producer)							  AND (vid_model=id_model)							  AND (vid_element=id_element)						      AND (vid_one = id_one)                               AND (vid_status = id_status)							                            ) As C      LEFT JOIN koef.sotrydniki AS K ON C.vid_sot = K.Id_sotLEFT JOIN koef.otdel AS OS ON K.Otdel_id = OS.id_otd '.$queryTerms;  //  AND (vid_status = 2)	If ((isset($_GET['dateStart'])) and (isset($_GET['dateFinish'])))  $SQLBig .= ' And C.date_give BETWEEN "'.$_GET['dateStart'].'" and "'.$_GET['dateFinish'].'"';Else   $SQLBig .= ' And C.date_give BETWEEN "'.$a.'" and "'.$b.'"';$SQLBig .= ' ORDER BY C.date_give DESC';$result = mysql_query($SQLBig, $db);    while ($row = mysql_fetch_array($result)) //результаты каждой строки   {  	   $one .= '<tr><td><a  style="color: #000000; " href="comp_info_one.php?id='.$row['id_one'].'" >'.$row['name_type'].': ';				if ($row['name_producer']=='не указано')					{						$one .='</a>';					}				elseif ($row['name_model']=='не указано')					{						$one .= $row['name_producer'].'</a>';					}					else					{					 $one .=  $row['name_producer'].' '.$row['name_model'].'</a>';					}					if ($row['file_name']=='') 					{							$one .= $row['file_name'].'</td>';					}					else					{						$one .= '<a  style="color: #000000; " target="_blank" href="reports/'.$row['file_name'].'" target="_blank">'.$row['file_name'].'</a></td>';					}	    $one .= '<td>'.$row['sn'].' ';					if ($row['plomb1']==0)					{						$one .= $row['plomb2'].'  </td>';					}					elseif ($row['plomb2']==0)						{							$one .=$row['plomb1'].'  </td>';						}						else 						{							$one .=$row['plomb1'].' / '.$row['plomb2'].'  </td>';						}		$one .='<td>'.$row['in_nom'].'</td>';				if ($row['buh_kart']==0) 		{			$one .='<td></td>';		}		else 		{			$result4 = mysql_query("SELECT * FROM buh_kart WHERE (id_buh_kart = ".$row['buh_kart'].")",$db);			while ($row4 = mysql_fetch_array($result4))			{$one .='<td><a style="color: #000000;  padding: 2px;" href="comp_buh_kart_info.php?id='.$row4['id_buh_kart'].'" >'.$row4['number_card'].' </a></td>';}		}		$one .='<td>'.$row['date_give'].'</td>';		$one .='<td>'.$row['date_return'].'</td><td>'.$row['remark_return'].'</td>';										if ($row['fio_give']==0)						{						$one .='<td> </td>';						}					else						{						$result1 = mysql_query("SELECT * FROM reg WHERE (id= ".$row['fio_give'].")",$db);						while ($row1 = mysql_fetch_array($result1))						  {$one .='<td>'.$row1['FIO'].' </td>';}						}					$one .='<td>'.$row['name_status'].'</td>';					if ($row['fio_return']==0)						{						$one .='<td> </td>';						}					else						{						$result1 = mysql_query("SELECT * FROM reg WHERE (id= ".$row['fio_return'].")",$db);						while ($row1 = mysql_fetch_array($result1))						  {$one .='<td>'.$row1['FIO'].' </td>';}						}						$one .='<td>'.$row['Name_otd'].'</td>';						                    if ($row['vid_sot'] != "" )							    {                        $FIO = $row['Fam']." ".$row['Imya']." ".$row['Otch'];										    $one .='<td><a style="color: #000000; " href="comp_LK.php?id='.$row['id_sot'].'">'.$FIO.'</td>';						}					else                         $one .='<td>'.$row['Name_otd'].'</td>';				}?></form>	<table class="table big_table table-striped table-bordered table-hover">		<thead  class="tit sort" > 			<tr>								<td>наименование оборудования </td>	 				<td>серийный номер</td>				<td>инв.номер</td>				<td>номер карточки</td>				<td>дата выдачи</td>				<td>дата возврата</td>				<td>примечание</td>				<td>кто выдал</td>				<td>статус</td>				<td>кто принял</td>				<td>отдел сотрудника</td>				<td>сотрудник</td>			</tr>		</thead>		<tbody > 			<?=$one;?>		</tbody>	</table></body></html>